Исходный текст - слегка модифицированная версия кода, взятого отсюда:
https://gist.github.com/seymores/2425692
